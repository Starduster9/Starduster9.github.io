<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>이미지 → 반죽 변환기 (아레나 전용)</title>
  <meta name="color-scheme" content="dark light">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="title" role="heading" aria-level="1">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M4 5h16v6H4z" stroke="#9fb3ff" stroke-width="1.8"/>
        <path d="M8 15h8m-6 4h4" stroke="#9fb3ff" stroke-width="1.8" stroke-linecap="round"/>
      </svg>
      <h1>이미지 → 반죽 변환기 (아레나 전용)</h1>
    </div>
    <div class="subtitle">
      순서대로 따라만 하세요. <strong>① 이미지 선택 → ② 변환 → ③ 반죽 복사</strong> 끝!
      <br><span aria-label="제작 크레딧">만든이: Starduster</span>
    </div>
  </header>

  <main>
    <!-- 1단계: 이미지 선택 -->
    <section class="card fade-in" aria-labelledby="step1">
      <div class="step-title" id="step1">① 이미지 선택</div>
      <p class="hint">전투 결과 스크린샷 파일을 올리세요. (용병이 꽉 차있지 않을 경우 에러가 날 수 있습니다.) </p>

      <div class="grid" style="margin-top:8px">
        <label for="imgInput" class="sr-only">이미지 파일 선택</label>
        <input id="imgInput" type="file" accept="image/*" aria-describedby="fileHint" />
        <div id="fileHint" class="hint">파일은 인터넷으로 전송되지 않고, 내 브라우저 안에서만 처리됩니다.</div>
        <img id="thumb" class="thumb" alt="미리보기 이미지" />
      </div>

      <progress id="tplProgress" max="100" value="0" style="width:100%; margin-top:12px"></progress>
      <div id="tplStatus" class="status" aria-live="polite"></div>
    </section>

    <!-- 2단계: 변환 실행 -->
    <section class="card fade-in" aria-labelledby="step2">
      <div class="step-title" id="step2">② 변환</div>
      <p class="hint">아래 버튼을 누르면 자동으로 분석하고 결과를 만들어 드립니다.</p>
      <div class="actions">
        <button id="runBtn" class="primary" disabled>변환 시작</button>
        <span id="status" class="status" aria-live="polite"></span>
      </div>
    </section>

    <!-- 3단계: 반죽 복사 -->
    <section class="card fade-in" aria-labelledby="step3">
      <div class="step-title" id="step3">③ 반죽 결과</div>
      <div class="grid" style="margin-top:8px">
        <div>
          <div class="copy-row">
            <button id="copyB64" class="ghost" aria-label="반죽 복사">복사</button>
            <span id="b64CopiedMark" class="status ok" style="display:none">복사되었습니다!</span>
          </div>
          <textarea id="b64Out" readonly aria-label="반죽"></textarea>
        </div>
      </div>

      <details>
        <summary>로그 자세히 보기</summary>
        <div class="preview-wrap" style="margin-top:10px">
          <canvas id="canvas" width="800" height="800" aria-label="이미지 처리 미리보기"></canvas>
          <pre id="log" class="hint" style="white-space:pre-wrap"></pre>
        </div>
        <div class="grid" style="margin-top:12px">
          <div>
            <label for="jsonOut">JSON 결과</label>
            <div class="copy-row">
              <button id="copyJson" class="ghost" aria-label="JSON 복사">복사</button>
              <span id="jsonCopiedMark" class="status ok" style="display:none">복사되었습니다!</span>
            </div>
            <textarea id="jsonOut" readonly aria-label="JSON 결과"></textarea>
          </div>
        </div>
      </details>
    </section>

    <p class="hint" style="text-align:center">이 도구는 브라우저에서만 작동하는 서버리스(OpenCV.js) 버전입니다. 파일은 외부로 업로드되지 않습니다.</p>
  </main>

  <!-- OpenCV.js (WASM) -->
  <script async src="https://docs.opencv.org/4.x/opencv.js" onload="onOpenCvReady()" onerror="cvLoadError()"></script>
  <!-- 앱 스크립트 -->
  <script defer src="script.js"></script>
</body>
</html>
