<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>랜덤 레이아웃 Base64 생성기</title>
  <style>
    :root {
      --bg: #0b1020;
      --panel: #121830;
      --ink: #e8ecf3;
      --muted: #98a3b7;
      --accent: #6ea8fe;
      --accent-2: #8be9fd;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, sans-serif;
      background: radial-gradient(1000px 800px at 20% -10%, #1b2350 0%, #0b1020 40%), var(--bg);
      color: var(--ink);
      display: grid; place-items: start center; padding: 32px 16px;
    }
    .app {
      width: min(900px, 100%);
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      overflow: hidden;
    }
    header { padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.08); }
    header h1 { margin: 0; font-size: 18px; }
    section { padding: 20px; display: grid; gap: 16px; }
    button {
      padding: 10px 14px; border: none; border-radius: 10px;
      background: linear-gradient(180deg, #28407a, #203667);
      color: white; font-weight: 600; cursor: pointer;
      transition: 0.2s;
    }
    button:hover { box-shadow: 0 4px 12px rgba(110,168,254,0.3); }
    button.secondary { background: #1e253f; }
    textarea {
      width: 100%; min-height: 120px; border-radius: 10px;
      background: #0b0f2a; color: #e8ecf3; border: 1px solid rgba(255,255,255,0.1);
      padding: 12px; font-family: monospace;
    }
    pre { background: #0b0f2a; padding: 12px; border-radius: 10px; font-size: 13px; overflow: auto; }
    .toast { position: fixed; bottom: 20px; right: 20px; background: #11193b; padding: 10px 16px; border-radius: 10px; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>랜덤 레이아웃 코드 생성기</h1>
    </header>
    <section>
      <div>
        <button id="generate">🎲 생성하기</button>
        <button id="copy" class="secondary">📋 복사하기</button>
      </div>
      <textarea id="output" readonly placeholder="여기에 Base64 코드가 생성됩니다"></textarea>
      <pre id="json"></pre>
    </section>
  </div>
  <div id="toast" class="toast" style="display:none;"></div>

  <script>
    const HERO_LEGEND_IDS = [106,108,109,113,114,115,117,118,119,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,150,151,152,153];
    const TROOP_IDS = [101,102,103,104,105,106,107,109,110,111,112,113,124,125,126,132,133,134,142,143,144,145,146,147,148,149,150,151,159,160,161,162,163,164,166,168,173,178,179,180,181,182,183,186,188,189,191,192,193,198,199,200,201,202,203,210,211,212,213,214,215,216,217,219,220];

    const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];

    function generateRandomLayout(heroIds, troopIds) {
      const troopPositions = [];
      for (let tens = 0; tens < 70; tens += 10) {
        for (let i = 0; i < 7; i++) troopPositions.push(tens + i);
      }

      const troopLayout = {};
      for (const pos of troopPositions) {
        const troopId = pick([...troopIds, null]);
        if (troopId !== null) {
          troopLayout[String(pos)] = troopId;
        }
      }

      const heroLayout = {};
      if (heroIds && heroIds.length) {
        const pos = pick([0, 1, 2]);
        heroLayout[String(pos)] = pick(heroIds);
      }

      const layout = {
        GameMode: 0,
        troopLayout,
        heroLayout,
        armyLayout: null,
      };

      const jsonStr = JSON.stringify(layout, null, 0);
      const base64 = btoa(unescape(encodeURIComponent(jsonStr)));
      return { base64, layout };
    }

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.style.display = 'block';
      setTimeout(() => toast.style.display = 'none', 2000);
    }

    document.getElementById('generate').addEventListener('click', () => {
      const { base64, layout } = generateRandomLayout(HERO_LEGEND_IDS, TROOP_IDS);
      document.getElementById('output').value = base64;
      document.getElementById('json').textContent = JSON.stringify(layout, null, 2);
    });

    document.getElementById('copy').addEventListener('click', async () => {
      const text = document.getElementById('output').value;
      if (!text) { showToast('먼저 코드를 생성하세요.'); return; }
      try {
        await navigator.clipboard.writeText(text);
        showToast('복사 완료 ✅');
      } catch {
        showToast('복사 실패 ❌');
      }
    });

    // 초기 1회 생성
    (function init() {
      const { base64, layout } = generateRandomLayout(HERO_LEGEND_IDS, TROOP_IDS);
      document.getElementById('output').value = base64;
      document.getElementById('json').textContent = JSON.stringify(layout, null, 2);
    })();
  </script>
</body>
</html>
